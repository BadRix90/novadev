<div class="speed-test-page">

    <!-- Page Header (wie Services!) -->
    <section class="speed-test-header">
        <div class="speed-test-header__container">
            <h1 class="speed-test-header__title">{{ texts.header.title }}</h1>
            <p class="speed-test-header__subtitle">{{ texts.header.subtitle }}</p>
        </div>
    </section>

    <!-- Input Section -->
    @if (!isLoading && !showResults) {
    <section class="speed-test-input">
        <div class="speed-test-input__container">
            <form class="speed-test-form" (ngSubmit)="onSubmit()">
                <div class="speed-test-form__group">
                    <label class="speed-test-form__label">{{ texts.input.label }}</label>
                    <input type="url" [(ngModel)]="websiteUrl" name="url" class="speed-test-form__input"
                        [placeholder]="texts.input.placeholder" required>
                </div>
                <button type="submit" class="speed-test-form__button" [disabled]="!isValidUrl()">
                    {{ texts.input.button }}
                </button>
                <p class="speed-test-form__info">{{ texts.input.info }}</p>
            </form>
        </div>
    </section>
    }

    <!-- Loading Section -->
    @if (isLoading) {
    <section class="speed-test-loading">
        <div class="speed-test-loading__container">
            <div class="speed-test-loading__spinner"></div>
            <h2 class="speed-test-loading__title">{{ texts.loading.title }}</h2>
            <p class="speed-test-loading__subtitle">{{ texts.loading.subtitle }}</p>
            <ul class="speed-test-loading__steps">
                @for (step of texts.loading.steps; track step) {
                <li>{{ step }}</li>
                }
            </ul>
        </div>
    </section>
    }

    <!-- Results Section (ECHTE DATEN!) -->
    @if (showResults) {
    <section class="speed-test-results">
        <div class="speed-test-results__container">
            <h2 class="speed-test-results__title">{{ texts.results.title }}</h2>
            <p class="speed-test-results__subtitle">{{ texts.results.subtitle }}</p>

            <!-- ECHTE Scores Grid -->
            <div class="speed-test-scores">
                <div class="score-card">
                    <div class="score-card__circle" [ngClass]="{
                   'score-card__circle--good': scores.performance >= 90,
                   'score-card__circle--average': scores.performance >= 50 && scores.performance < 90,
                   'score-card__circle--poor': scores.performance < 50
                 }">
                        {{ scores.performance }}
                    </div>
                    <h3 class="score-card__label">{{ texts.results.scores.performance }}</h3>
                </div>
                <div class="score-card">
                    <div class="score-card__circle" [ngClass]="{
                   'score-card__circle--good': scores.seo >= 90,
                   'score-card__circle--average': scores.seo >= 50 && scores.seo < 90,
                   'score-card__circle--poor': scores.seo < 50
                 }">
                        {{ scores.seo }}
                    </div>
                    <h3 class="score-card__label">{{ texts.results.scores.seo }}</h3>
                </div>
                <div class="score-card">
                    <div class="score-card__circle" [ngClass]="{
                   'score-card__circle--good': scores.accessibility >= 90,
                   'score-card__circle--average': scores.accessibility >= 50 && scores.accessibility < 90,
                   'score-card__circle--poor': scores.accessibility < 50
                 }">
                        {{ scores.accessibility }}
                    </div>
                    <h3 class="score-card__label">{{ texts.results.scores.accessibility }}</h3>
                </div>
                <div class="score-card">
                    <div class="score-card__circle" [ngClass]="{
                   'score-card__circle--good': scores.bestPractices >= 90,
                   'score-card__circle--average': scores.bestPractices >= 50 && scores.bestPractices < 90,
                   'score-card__circle--poor': scores.bestPractices < 50
                 }">
                        {{ scores.bestPractices }}
                    </div>
                    <h3 class="score-card__label">{{ texts.results.scores.bestPractices }}</h3>
                </div>
            </div>

            <div class="speed-test-metrics">
                <h3 class="speed-test-metrics__title">{{ texts.results.metrics.title }}</h3>
                <div class="speed-test-metrics__grid">

                    <div class="metric-card">
                        <div class="metric-card__value">{{ metrics.fcp }}</div>
                        <div class="metric-card__label">{{ texts.results.metrics.fcp }}</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-card__value">{{ metrics.lcp }}</div>
                        <div class="metric-card__label">{{ texts.results.metrics.lcp }}</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-card__value">{{ metrics.tbt }}</div>
                        <div class="metric-card__label">{{ texts.results.metrics.tbt }}</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-card__value">{{ metrics.cls }}</div>
                        <div class="metric-card__label">{{ texts.results.metrics.cls }}</div>
                    </div>

                </div>
            </div>

            <div class="speed-test-suggestions">
                <h3 class="speed-test-suggestions__title">{{ texts.results.suggestions.title }}</h3>
                <p class="speed-test-suggestions__subtitle">{{ texts.results.suggestions.subtitle }}</p>

                @if (suggestions.length > 0) {
                <div class="suggestions-list">
                    @for (suggestion of suggestions; track suggestion.title) {
                    <div class="suggestion-card" [attr.data-priority]="suggestion.priority">
                        <div class="suggestion-card__header">
                            <span class="suggestion-card__priority" [ngClass]="{
                            'suggestion-card__priority--high': suggestion.priority === 'high',
                            'suggestion-card__priority--medium': suggestion.priority === 'medium',
                            'suggestion-card__priority--low': suggestion.priority === 'low'
                          }">
                                {{ texts.results.suggestions.priority[suggestion.priority] }}
                            </span>
                        </div>
                        <h4 class="suggestion-card__title">{{ suggestion.title }}</h4>
                        <p class="suggestion-card__description">{{ suggestion.description }}</p>
                    </div>
                    }
                </div>
                } @else {
                <p class="speed-test-suggestions__empty">{{ texts.results.suggestions.empty }}</p>
                }
            </div>

            <!-- Actions -->
            <div class="speed-test-actions">
                <button class="speed-test-actions__button speed-test-actions__button--primary" (click)="startNewTest()">
                    {{ texts.results.actions.newTest }}
                </button>
                <button class="speed-test-actions__button speed-test-actions__button--secondary"
                    (click)="shareResults()">
                    {{ texts.results.actions.share }}
                </button>
            </div>
        </div>
    </section>
    }

    <!-- Error Message -->
    @if (errorMessage) {
    <section class="speed-test-error">
        <div class="speed-test-error__container">
            <p class="speed-test-error__message">{{ errorMessage }}</p>
            <button class="speed-test-actions__button speed-test-actions__button--primary" (click)="startNewTest()">
                Zurück
            </button>
        </div>
    </section>
    }

    @if (showToast) {
    <div class="toast">
        <span class="toast__icon">✓</span>
        <span class="toast__text">{{ texts.results.actions.copied }}</span>
    </div>
    }

</div>